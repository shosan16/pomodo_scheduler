<% provide(:title, 'All users') %>
<h1>ユーザー検索</h1>
<%= search_form_for @q, url: search_users_path do |f| %>
  <%= f.label :name_cont, 'ユーザー名' %>
  <%= f.search_field :name_cont %>
  <br>
  <%= f.submit '検索' %>
<% end %>

<ul class="users">
  <% @users.each do |user| %>
    <li>
    <div class="col-md-4">
      <%= gravatar_for user, size: 50 %>
      <%= link_to user.name, user %>
    </div>
    <div class="col-md-4">
    <% unless current_user?(user) %>
        <% if current_user.following?(user) %>
          <%= form_with(model: current_user.active_relationships.find_by(followed_id: user.id),
                        html: { method: :delete }, local: true) do |f| %>
          <%= f.submit "フォロー解除", class: "btn btn-default" %>
          <% end %>
        <% else %>
        <%= form_with(model: current_user.active_relationships.build, local: true) do |f| %>
                <div><%= hidden_field_tag :followed_id, user.id %></div>
                <%= f.submit "フォロー", class: "btn btn-primary" %>
          <% end %>
        <% end %>
    </div>  
      <% end %>
    </li>
  <% end %>
</ul>

<%= will_paginate %>

